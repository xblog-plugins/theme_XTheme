// js 压缩网站 https://tool.lu/js/
// 搜索框功能
if($("#search-box").length>0){new Vue({el:'#search-box',data:{keyword:'',keywords:[]},watch:{keyword(res){if(this.keyword===''){$('.search-suggest').css('display','none')}else{xy.net.request("posts","GET",{"q":this.keyword}).then((data)=>{this.keywords=data.contents});$('.search-suggest').css('display','block')}}},methods:{search(){window.location.href="/?q="+this.keyword;$('.search-suggest').css('display','none')}}})}
// 文档功能
if($("#doc-app").length>0){new Vue({el:'#doc-app',data:{docList:[],filterText:'',key:[],check:[],docContent:{title:'',content:''}},watch:{filterText(val){this.$refs.tree.filter(val)}},mounted(){this.getDocList()},methods:{filterNode(value,data){if(!value){return true}else{return data.label.includes(value)}},sideBar(){if($('.sidebar').css('margin-left')==='0px'){$('.sidebar').css('margin-left','-280px')}else{$('.sidebar').css('margin-left','0')}},click(choose){window.history.pushState({id:1,name:'doc'},'测试','/doc/'+choose.id);this.setDocContent(choose.id)},setDocContent(id){xy.net.request('plugins/docs/'+id,"GET").then((data)=>{window.scroll(0,0);this.docContent=data})},getDocList(){xy.net.request("plugins/docs","GET").then((data)=>{this.docList=this.DataProcess(data)})},DataProcess(data){let trees=[];if(data!=null){for(let i=0;i<data.length;i++){if(data[i].parent===0){trees.push({id:data[i].id,label:data[i].title})}}trees=this.InsertChild(trees,data)}return trees},InsertChild(trees,data){for(let i=0;i<trees.length;i++){for(let j=0;j<data.length;j++){if(trees[i].id===data[j].parent){if(Object.prototype.hasOwnProperty.call(trees[i],'children')){trees[i].children.push({id:data[j].id,label:data[j].title})}else{trees[i].children=[{id:data[j].id,label:data[j].title}]}}}if(Object.prototype.hasOwnProperty.call(trees[i],'children')){trees[i].children=this.InsertChild(trees[i].children,data)}}return trees}}});const high=$(document).height()-$('#navigation').height()-$('#footer').height();$('#doc-app').css('min-height',high+'px')}
// 首页文章分页和分类
if($("#post-list").length>0){new Vue({el:'#post-list-pagination',data:{total:globalTotal,current:globalCurrent,},methods:{getPosts(res){let category=xy.tools.getQueryVariable("category");let tag=xy.tools.getQueryVariable("tag");let q=xy.tools.getQueryVariable("q");if(category){res+="&category="+category}if(tag){res+="&tag="+tag}if(q){res+="&q="+q}window.location.href="/?page="+res}}});new Vue({el:"#post-list-category"})}
// 回到顶部和网站运行时间
if($("#footer").length>0){$(window).scroll(function(){const $win = $(window);if($win.scrollTop()>200){$('#to-top').css("display","block")}else{$('#to-top').css("display","none")}});$("#to-top").click(function(){let t=0;const e=$('#to-top');const Ct=setInterval(function(){t++;e.css({'background-position-x':-(143*t+40)+'px'});if(t===5){e.addClass('transition');e.addClass('fly');setTimeout(function(){e.removeClass('fly')},2000)}if(t===6){t=0;clearInterval(Ct);$('html, body').stop().animate({scrollTop:0},'fast')}},50)});function createTime(time, el){const now=new Date();const grt=new Date(time);now.setTime(now.getTime()+250);const days=(now-grt)/1000/60/60/24;const dnum=Math.floor(days);const hours=(now-grt)/1000/60/60-(24*dnum);let hnum=Math.floor(hours);if(String(hnum).length===1){hnum='0'+hnum}const minutes=(now-grt)/1000/60-(24*60*dnum)-(60*hnum);let mnum=Math.floor(minutes);if(String(mnum).length===1){mnum='0'+mnum}const seconds=(now-grt)/1000-(24*60*60*dnum)-(60*60*hnum)-(60*mnum);let snum=Math.round(seconds);if(String(snum).length===1){snum='0'+snum}document.getElementById(el).innerHTML=dnum+'天'+hnum+'小时'+mnum+'分'+snum+'秒'}setInterval(()=>{createTime(globalBuildTime,'span_dt_dt')},1000)}
// 文章气泡
if($("#bubble").length>0){let width;let height;let containerID;let canvasID;let ctx;let circles;const animateHeader=!0;let canvasLoad=1;function doCanvas(){initHeader();addListeners()}function initHeader(){containerID=$('.thumbnail-shadow')[0];canvasID=document.getElementById('bubble');width=containerID.offsetWidth;height=containerID.offsetHeight;canvasID.width=width;canvasID.height=height;ctx=canvasID.getContext('2d');circles=[];for(let t=0;t<0.1*width;t++){const e=new Circle();circles.push(e)}canvasLoad===1&&(animate(),canvasLoad=0)}function animate(){if(animateHeader){ctx.clearRect(0,0,width,height);for(const t in circles){circles[t].draw()}}requestAnimationFrame(animate)}function addListeners(){window.addEventListener('resize',resize)}function resize(){containerID=$('.thumbnail-shadow')[0];width=containerID.offsetWidth;height=containerID.offsetHeight;canvasID.width=width;canvasID.height=height}function Circle(){const e=this;function t(){e.pos.x=Math.random()*width;e.pos.y=height+110*Math.random();e.alpha=0.1+0.3*Math.random();e.scale=0.1+0.5*Math.random();e.velocity=Math.random()}!(function(){e.pos={};t()}());this.draw=function(){e.alpha<=0&&t();e.pos.y-=e.velocity;e.alpha-=5e-4;ctx.beginPath();ctx.arc(e.pos.x,e.pos.y,10*e.scale,0,2*Math.PI,!1);ctx.fillStyle='rgba(255,255,255,'+e.alpha+')';ctx.fill()}}doCanvas()}
// 文章gonn部分
if($("#post-functions").length>0){new Vue({el:'#post-functions',data:{alipay:globalAlipay,wechat:globalWechat,id:globalPostId,password:''},methods:{close(){$('.layer').css('display','none')},open(){$('.layer').css('display','block')},switchpay(option){if(option==='aliy'){$('#wechat_qr').css('display','none');$('#alipay_qr').css('display','inline-block')}else{$('#wechat_qr').css('display','inline-block');$('#alipay_qr').css('display','none')}},love(){xy.net.request('posts/'+globalPostId+'/liked',"PUT","").then(_=>this.$message.success('点赞成功，感谢支持！')).catch(msg=>this.$message.warning(msg))},getEncryptContent(password){window.location.href='?password='+password},sharebar(){if($('.share-wrap').css('display')==='none'){$('.share-wrap').css('display','block')}else{$('.share-wrap').css('display','none')}},share(obj){const qqShareURL='http://connect.qq.com/widget/shareqq/index.html?';const weiboShareURL='http://service.weibo.com/share/share.php?';const qzoneShareURL='https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?';const facebookShareURL='https://www.facebook.com/sharer/sharer.php?';const twitterShareURL='https://twitter.com/intent/tweet?';const hostUrl='https://xiaoyou66.com/archives/477';const title='';const qqtitle='';const excerpt='';const wbexcerpt='';const pic='https://xiaoyou66.com/wp-content/uploads/2019/04/ic_launcher-web.png';let _URL;if(obj==='qq'){_URL=qqShareURL+'url='+hostUrl+'&title='+qqtitle+'&pics='+pic+'&desc=&summary='+excerpt+'&site=vtrois'}else if(obj==='weibo'){_URL=weiboShareURL+'url='+hostUrl+'&title='+title+wbexcerpt+'&pic='+pic}else if(obj==='qzone'){_URL=qzoneShareURL+'url='+hostUrl+'&title='+qqtitle+'&pics='+pic+'&desc=&summary='+excerpt+'&site=vtrois'}else if(obj==='facebook'){_URL=facebookShareURL+'u='+hostUrl}else if(obj==='twitter'){_URL=twitterShareURL+'text='+title+excerpt+'&url='+hostUrl}window.open(_URL)}}})}
// 文章导航栏和密码部分
if($("#post-content").length>0){new Vue({el: '#post-breadcrumb'});}
// 评论区
if($("#comments").length>0){const comment=new Vue({el:'#comments',data:{isLogin:false,postId:globalPostId,parent:0,commentData:{email:'',content:'',name:'',post_id:'',user_id:0,parent:0,site:'',avatar:globalAvatar,level:'',hang:'',uid:''},rules:{name:[{required:true,message:'昵称不能为空'}],content:[{required:true,message:'评论内容不能为空'}],email:[{validator:(rule,value,callback)=>xy.validate.checkEmail(value)?callback():callback(new Error('邮箱格式不正确'))}]},},created(){if(globalIsLogin){const info=JSON.parse(globalUserInfo);this.isLogin=true;this.commentData.avatar=info.avatar;this.commentData.hang=info.hang;this.commentData.email=info.email;this.commentData.name=info.nickname;this.commentData.user_id=info.user_id}},computed:{uid(){return this.commentData.uid},},watch:{uid(uid){xy.net.request("tools/bili_info/"+uid,"GET",{}).then((res)=>{this.commentData.avatar=res.avatar;this.commentData.name=res.nickname;this.commentData.hang=res.hang;this.commentData.level=res.level.toString()})}},methods:{reply(id){const respond=$('#respond');$('#comment-'+id).append(respond);$('#cancel-comment-reply-link').css('display','block');respond.css('border','1px solid #7266ba');$('#comment_parent').attr('value',id);this.parent=id},cancelComment(){const respond=$('#respond');$('#comments').append(respond);$('#cancel-comment-reply-link').css('display','none');respond.css('border','none');this.parent=0},comment(){this.commentData.post_id=parseInt(this.postId);this.commentData.parent=this.parent;this.commentData.content=$('#comment').val();if(this.commentData.avatar===globalAvatar){this.commentData.avatar=''}this.$refs.comment.validate((ok)=>{if(ok&&!this.commenting){this.commenting=true;let token=JSON.parse(xy.tools.getCookie('token'));let head={'user_id':token["user_id"],'token':token['token']};xy.net.request('posts/'+this.postId+'/comments',"POST",this.commentData,head).then(()=>{window.location.reload();this.cancelComment()}).catch(msg=>this.$message.error(msg)).finally(()=>{this.commenting=false})}})}}})}
// owo表情
if($("#comment-form").length>0){function _classCallCheck(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var s=t[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,a,s){return a&&e(t.prototype,a),s&&e(t,s),t}}();!function(){var e=function(){function e(t){var a=this;_classCallCheck(this,e);var s={logo:"OwO表情",container:document.getElementsByClassName("OwO")[0],position:"up",width:"90%",maxHeight:"250px",api:""};for(var n in s){s.hasOwnProperty(n)&&!t.hasOwnProperty(n)&&(t[n]=s[n])}this.container=t.container,"up"===t.position&&this.container.classList.add("OwO-up");var i=new XMLHttpRequest;i.onreadystatechange=function(){4===i.readyState&&(i.status>=200&&i.status<300||304===i.status?(a.odata=JSON.parse(i.responseText),a.init(t)):console.log("OwO data request was unsuccessful: "+i.status))},i.open("get",t.api,!0),i.send(null)}return _createClass(e,[{key:"init",value:function(e){var t=this;this.packages=Object.keys(this.odata);for(var a='\n            <div class="OwO-logo"><span>'+e.logo+'</span></div>\n            <div class="OwO-body" style="width: '+e.width+'">',s=0;s<this.packages.length;s++){a+='\n                <ul class="OwO-items OwO-items-'+this.odata[this.packages[s]].type+'" style="max-height: '+(parseInt(e.maxHeight)-53+"px")+';">';for(var n=this.odata[this.packages[s]].container,i=0;i<n.length;i++){var temp0=n[i].icon;if(temp0.substr(0,1)=="/"){var temp0='<img src="'+n[i].icon+'">'}a+='\n                    <li class="OwO-item" title="'+n[i].text+'"><a href="javascript:grin('+n[i].desc+')">'+temp0+"</a></li>"}a+="\n                </ul>"}a+='\n                <div class="OwO-bar">\n                    <ul class="OwO-packages">';for(var o=0;o<this.packages.length;o++){a+="\n                        <li><span>"+this.packages[o]+"</span></li>"}a+="\n                    </ul>\n                </div>\n            </div>\n            ",this.container.innerHTML=a,this.logo=this.container.getElementsByClassName("OwO-logo")[0],this.logo.addEventListener("click",function(){t.toggle()}),this.packagesEle=this.container.getElementsByClassName("OwO-packages")[0];for(var c=function(e){!function(a){t.packagesEle.children[e].addEventListener("click",function(){t.tab(a)})}(e)},l=0;l<this.packagesEle.children.length;l++){c(l)}this.tab(0)}},{key:"toggle",value:function(){this.container.classList.contains("OwO-open")?this.container.classList.remove("OwO-open"):this.container.classList.add("OwO-open")}},{key:"tab",value:function(e){var t=this.container.getElementsByClassName("OwO-items-show")[0];t&&t.classList.remove("OwO-items-show"),this.container.getElementsByClassName("OwO-items")[e].classList.add("OwO-items-show");var a=this.container.getElementsByClassName("OwO-package-active")[0];a&&a.classList.remove("OwO-package-active"),this.packagesEle.getElementsByTagName("li")[e].classList.add("OwO-package-active")}}]),e}();"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=e:window.OwO=e}();function grin(tag){var myField;tag=" "+tag+" ";if(document.getElementById("comment")&&document.getElementById("comment").type=="textarea"){myField=document.getElementById("comment")}else{return false}if(document.selection){myField.focus();sel=document.selection.createRange();sel.text=tag;myField.focus()}else{if(myField.selectionStart||myField.selectionStart=="0"){var startPos=myField.selectionStart;var endPos=myField.selectionEnd;var cursorPos=endPos;myField.value=myField.value.substring(0,startPos)+tag+myField.value.substring(endPos,myField.value.length);cursorPos+=tag.length;myField.focus();myField.selectionStart=cursorPos;myField.selectionEnd=cursorPos;var owoopen=document.getElementsByClassName("OwO OwO-open")[0];owoopen.className="OwO"}else{myField.value+=tag;myField.focus()}}};new OwO({logo:'OωO表情',container:document.getElementsByClassName('OwO')[0],target:document.getElementById('comment'),api:'/api/v3/tools/smiles',position:'up',width:'100%',maxHeight:'250px'})}
// 日记部分
if($("#diary-list").length>0){new Vue({el:'#diary-list',data:{total:globalTotal,current:globalCurrent,password:''},methods:{getDiary(page){window.location.href=xy.tools.updateQueryStringParameter(window.location.href,'page',page)},getEncryptContent(id){window.location='/archives/'+id+'?password='+this.password},gotoDiary(id){window.location='/archives/'+id}}})}
